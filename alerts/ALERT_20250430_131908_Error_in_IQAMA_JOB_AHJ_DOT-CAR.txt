SUBJECT: Error in IQAMA_JOB_AHJ_DOT-CARE on AHQ-AI-02
TIME: 2025-04-30 13:19:08
HOST: AHQ-AI-02
SYSTEM: Windows 2019Server
PYTHON: 3.12.8

==================================================

An error occurred in the IQAMA_JOB_AHJ_DOT-CARE job on AHQ-AI-02 at 2025-04-30 13:19:08.

Error details:
(pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '€'. (102) (SQLExecDirectW)")
[SQL: SELECT  
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚V.ID AS visit_id ,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚V.CreatedDate AS start_date,
        V.UpdatedDate AS end_date,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.ID AS patient_id,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CONVERT(DATE,P.DateOfBirth) AS date_of_birth,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.OccupationID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚OCC.EnName AS Occupation,
            CONCAT(P.EnFirstName, ' ', P.EnSecondName, ' ', P.EnThridName, ' ', P.EnLastName) AS patient_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnLastName AS family_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnFirstName AS pat_name_1,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnSecondName AS pat_name_2,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚G.EnName AS gender,
            P.NationalityID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚MS.EnName AS marital_char,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CASE WHEN P.NationalityID=56 THEN 'NI'
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ WHEN P.NationalityID !=56 AND P.IdentificationTypeID =2 THEN 'PPN'
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ ELSE 'PRC' END AS nationality,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.IdentificationValue AS iqama_no,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚1 AS  Organization_Code,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚'ANDALUSIA HOSPITAL JEDDAH -  PROD' AS 'Organization Name',
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚10000000046019 AS 'provider-license',

â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientPolicyNumber,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorCode AS insurer,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.InsuranceCardNo,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientEnName,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CGWM.EnName AS purchaser_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CGWM.Code AS payer_linces

â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚


FROM VisitMgt.Visit AS v
LEFT JOIN VisitMgt.VisitFinincailInfo AS vfi
â€‚â€‚â€‚â€‚â€‚â€‚ON vfi.VisitID = v.id
LEFT JOINâ€‚â€‚â€‚MPI.Patient P
â€‚â€‚â€‚â€‚â€‚â€‚on p.id=v.patientid
LEFT JOIN MPI.SLKP_Occupation OCC
â€‚â€‚â€‚â€‚â€‚â€‚ON P.OccupationID=OCC.ID
LEFT JOIN MPI.SLKP_Gender G
â€‚â€‚â€‚â€‚â€‚â€‚ON P.GenderID=G.ID
LEFT JOIN MPI.SLKP_MaritalStatus MS
â€‚â€‚â€‚â€‚â€‚â€‚ON P.MaritalStatusID=MS.ID
LEFT JOIN Billing.ContractorGateWayMappings CGWM
â€‚â€‚â€‚â€‚â€‚â€‚ON CGWM.ContractorID=VFI.ContractorID AND CGWM.GateWayID=3

WHERE  CONVERT(DATE,V.CreatedDate) >= DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) ---FROM THE FIRST OF THE MONTH 
--AND CONVERT(DATE,V.CreatedDate)=CONVERT(DATE,GETDATE()) --FOR TODATY ONLY 
--AND  CONVERT(DATETIME,V.CreatedDate) >= DATEADD(HOUR, -4, GETDATE())   --LAST 4 HOURS
]
(Background on this error at: https://sqlalche.me/e/20/f405)

Traceback (most recent call last):
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '€'. (102) (SQLExecDirectW)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\eligibilty_api_schedule.py", line 65, in _eligibility_iqama_job
    df_new = pd.read_sql_query(query, engine)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\pandas\io\sql.py", line 526, in read_sql_query
    return pandas_sql.read_query(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\pandas\io\sql.py", line 1836, in read_query
    result = self.execute(sql, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\pandas\io\sql.py", line 1659, in execute
    return self.con.exec_driver_sql(sql, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 1776, in exec_driver_sql
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Data-Science\Deployment\Eligibilty_api_schedule\myenv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '€'. (102) (SQLExecDirectW)")
[SQL: SELECT  
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚V.ID AS visit_id ,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚V.CreatedDate AS start_date,
        V.UpdatedDate AS end_date,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.ID AS patient_id,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CONVERT(DATE,P.DateOfBirth) AS date_of_birth,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.OccupationID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚OCC.EnName AS Occupation,
            CONCAT(P.EnFirstName, ' ', P.EnSecondName, ' ', P.EnThridName, ' ', P.EnLastName) AS patient_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnLastName AS family_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnFirstName AS pat_name_1,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.EnSecondName AS pat_name_2,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚G.EnName AS gender,
            P.NationalityID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚MS.EnName AS marital_char,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CASE WHEN P.NationalityID=56 THEN 'NI'
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ WHEN P.NationalityID !=56 AND P.IdentificationTypeID =2 THEN 'PPN'
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ ELSE 'PRC' END AS nationality,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚P.IdentificationValue AS iqama_no,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚1 AS  Organization_Code,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚'ANDALUSIA HOSPITAL JEDDAH -  PROD' AS 'Organization Name',
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚10000000046019 AS 'provider-license',

â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientPolicyNumber,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorCode AS insurer,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.InsuranceCardNo,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientEnName,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚vfi.ContractorClientID,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CGWM.EnName AS purchaser_name,
â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚CGWM.Code AS payer_linces

â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚


FROM VisitMgt.Visit AS v
LEFT JOIN VisitMgt.VisitFinincailInfo AS vfi
â€‚â€‚â€‚â€‚â€‚â€‚ON vfi.VisitID = v.id
LEFT JOINâ€‚â€‚â€‚MPI.Patient P
â€‚â€‚â€‚â€‚â€‚â€‚on p.id=v.patientid
LEFT JOIN MPI.SLKP_Occupation OCC
â€‚â€‚â€‚â€‚â€‚â€‚ON P.OccupationID=OCC.ID
LEFT JOIN MPI.SLKP_Gender G
â€‚â€‚â€‚â€‚â€‚â€‚ON P.GenderID=G.ID
LEFT JOIN MPI.SLKP_MaritalStatus MS
â€‚â€‚â€‚â€‚â€‚â€‚ON P.MaritalStatusID=MS.ID
LEFT JOIN Billing.ContractorGateWayMappings CGWM
â€‚â€‚â€‚â€‚â€‚â€‚ON CGWM.ContractorID=VFI.ContractorID AND CGWM.GateWayID=3

WHERE  CONVERT(DATE,V.CreatedDate) >= DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) ---FROM THE FIRST OF THE MONTH 
--AND CONVERT(DATE,V.CreatedDate)=CONVERT(DATE,GETDATE()) --FOR TODATY ONLY 
--AND  CONVERT(DATETIME,V.CreatedDate) >= DATEADD(HOUR, -4, GETDATE())   --LAST 4 HOURS
]
(Background on this error at: https://sqlalche.me/e/20/f405)


Please check the scheduler.log file for more information.